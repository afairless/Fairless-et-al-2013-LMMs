{
    "contents" : "# Andrew Fairless,  August 2011\n# modified May 2015 for posting onto Github\n# This script implements linear mixed models as reported in Fairless et al 2013\n# Fairless et al 2013,  doi: 10.1016/j.bbr.2012.08.051,  PMID: 22982070,  PMCID: PMC3554266\n\n# Since this script was originally written, the R package 'lme4' has been revised so that\n# this script no longer works.\n# Specifically, the attributes/fields of the linear mixed effects model produced by the \n# function 'lmer' have been changed, so that the function 'pvals.fncaf' (altered from the\n# original 'pvals.fnc') can not access them (e.g., 'modelname@coefs' no longer exists).\n# A version of the old 'lme4' package exists as 'lme4.0'.  I was not able to get 'lme4.0'\n# to work with my code here.\n# See https://github.com/lme4/lme4/blob/master/misc/notes/release_notes.md\n# See http://cran.r-project.org/web/packages/lme4/README.html\n\n# The fictional data in \"altereddata.txt\" were modified from the original \n# empirical data used in Fairless et al 2013.\n# I am using fictional data instead of the original data because I do not have \n# permission of my co-authors to release the data into the public domain.  \n# NOTE:  Because these data are fictional, several important characteristics of\n# these data may be different from those of the original data (e.g., the litter\n# sex ratio and litter size differ for individual mice of the same litter, even \n# though that is not possible with real, non-fictional data).\n\n# Data description:\n# Each row is a separate mouse.\n# Each column is a separate variable.\n# Strain, sex, and age are independent variables and fixed effects in the linear mixed models.\n# Cage and litter are independent varaibles and random effects in the linear mixed models.\n# From left to right, \"nosesniff\" to \"nonsocial\" are home cage behaviors and dependent variables.\n# From left to right, \"chambtime\" to \"testfollowstim\" are Social Approach/Choice Test behaviors \n# and dependent variables.\n\n# install.packages(\"lme4\", dependencies = TRUE)     # install package if not already installed\ninstall.packages(\"lme4.0\", type = \"both\", \n                 repos = c(\"http://lme4.r-forge.r-project.org/repos\", \n                           getOption(\"repos\")[[\"CRAN\"]]))\n\nlibrary(lme4)\nsource(\"pvals.fncaf.txt\")\n\ndata = read.table(\"altereddata.txt\", header = TRUE)\ndata = split(data, data$age)[[1]]                # includes only 30-day-old mice; excludes 41- and 69-day-old mice\n\n# specifies statistical models\nmodelcalls = \"a\"\nmodelcalls[1] = \"data[ , iter] ~ (strain + sex)^2 + (1|cage) + (1|litter)\"\nmodelcalls[2] = \"data[ , iter] ~ (strain + sex)^2 + (1|cage)\"\n\ndepvarcolstart = 9                                # left-most column/dependent variable to include in analysis\ndepvarcolstop = 22                                # right-most column/dependent variable to include in analysis\ndepvarn = depvarcolstop - (depvarcolstart - 1)    # number of columns/dependent variables to include in analysis\nmaxnumberfixef = 6                                # maximum number of fixed effects in any of the specified statistical models\n\n# sets up template table of p values for each dependent variable\nptable = NA\nptable = as.data.frame(ptable)\nptable[ , 1:(2 * (depvarn))] = NA\nptable[1:maxnumberfixef, ] = NA\ncolnames(ptable)[1:depvarn] = \n     paste(colnames(data)[depvarcolstart:depvarcolstop], \"pmc\", sep = \"\")\ncolnames(ptable)[(depvarn + 1):(depvarn * 2)] = \n     paste(colnames(data)[depvarcolstart:depvarcolstop], \"pt\", sep = \"\")\n\n# sets up table of p values for each statistical model\noutput = list()[1:length(modelcalls)]\nnames(output) = modelcalls\nfor (iter in 1:length(modelcalls)) {\n     output[[iter]] = ptable\n}\n\n# calculates p values for the linear mixed effects models for each dependent variable\n# and saves the p values to a table 'output'\nfor (iter2 in 1:length(modelcalls)) {                                      # loop iterates along each specificied statistical model\n     for (iter in depvarcolstart:depvarcolstop) {                          # loop iterates along each dependent variable\n          model = lmer(modelcalls[iter2], data = data)                     # fits linear mixed effects model to data\n          modelpvals = pvals.fncaf(model, nsim = 10000, addPlot = FALSE)   # calculates p values of fixed effects using MCMC method\n          if (iter ==  depvarcolstart) {\n               output[[iter2]] = ptable[1:(dim(modelpvals$fixed)[1] - 1), ]\n          }\n          output[[iter2]][ , (iter - (depvarcolstart - 1))] = as.numeric(modelpvals$fixed[2:dim(modelpvals$fixed)[1], 5])\n          output[[iter2]][ , ((iter - (depvarcolstart - 1)) + depvarn)] = as.numeric(modelpvals$fixed[2:dim(modelpvals$fixed)[1], 6])\n     }\n     rownames(output[[iter2]]) = rownames(modelpvals$fixed)[2:dim(modelpvals$fixed)[1]]\n}\n",
    "created" : 1432599720737.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3373125407",
    "id" : "99B69696",
    "lastKnownWriteTime" : 1432599295,
    "path" : "/media/zh/My Passport/backup/2015 code share/Fairless et al 2013 LMMs/to share/revising.R",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}